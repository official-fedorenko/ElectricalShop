# Интеграция фронтенда с backend API - Руководство по тестированию

## Обзор интеграции

Фронтенд теперь полностью интегрирован с backend API и поддерживает два режима работы:

1. **Реальный API режим** - когда backend доступен
2. **Демо режим** - автоматический fallback если backend недоступен

## Настройка переменных окружения

В файле `.env` вы можете настроить:

```env
# API Configuration
VITE_API_URL=http://localhost:3000/api
VITE_DEMO_MODE=true

# App Configuration
VITE_APP_NAME=LessElectrical Shop
VITE_APP_VERSION=1.0.0
```

- `VITE_API_URL` - URL backend API
- `VITE_DEMO_MODE` - принудительное включение демо режима

## Как протестировать интеграцию

### 1. Тестирование с backend

1. Запустите MongoDB:

   ```bash
   # Запустите MongoDB Community Server или MongoDB Atlas
   ```

2. Запустите backend:

   ```bash
   cd server
   npm run dev
   ```

3. Инициализируйте базу данных (если нужно):

   ```bash
   cd server
   npm run init-db
   ```

4. Запустите фронтенд:

   ```bash
   npm run dev
   ```

5. Установите в `.env`: `VITE_DEMO_MODE=false`

### 2. Тестирование в демо режиме

1. Установите в `.env`: `VITE_DEMO_MODE=true`
2. Запустите только фронтенд: `npm run dev`
3. Backend не требуется

### 3. Тестирование fallback режима

1. Установите в `.env`: `VITE_DEMO_MODE=false`
2. Запустите фронтенд без backend
3. Приложение автоматически переключится на демо данные

## Функциональность для тестирования

### Главная страница

- ✅ Загрузка товаров из API/демо данных
- ✅ Поиск по товарам
- ✅ Фильтрация по категориям и цене
- ✅ Переключение между grid/list режимами
- ✅ Добавление товаров в корзину (toast уведомления)

### Аутентификация

- ✅ Регистрация новых пользователей
- ✅ Вход в систему
- ✅ Автоматическая проверка токена при загрузке
- ✅ Выход из системы

#### Тестовые аккаунты (демо режим):

- **Администратор**: `admin@shop.com` / любой пароль (6+ символов)
- **Пользователь**: `user@shop.com` / любой пароль (6+ символов)

### Админпанель (только для администраторов)

#### Управление товарами:

- ✅ Просмотр списка товаров
- ✅ Добавление новых товаров
- ✅ Редактирование существующих товаров
- ✅ Удаление товаров
- ✅ Статистика товаров

#### Управление пользователями:

- ✅ Просмотр списка пользователей
- ✅ Назначение/снятие роли администратора
- ✅ Удаление пользователей
- ✅ Защита от удаления последнего администратора

## API Endpoints (backend)

### Аутентификация

- `POST /api/auth/register` - регистрация
- `POST /api/auth/login` - вход
- `GET /api/auth/verify` - проверка токена

### Товары

- `GET /api/products` - список товаров
- `POST /api/products` - создание товара
- `PUT /api/products/:id` - обновление товара
- `DELETE /api/products/:id` - удаление товара

### Пользователи

- `GET /api/users` - список пользователей
- `PUT /api/users/:id/role` - изменение роли
- `DELETE /api/users/:id` - удаление пользователя

### Статистика

- `GET /api/stats/products` - статистика товаров
- `GET /api/stats/users` - статистика пользователей

## Технические детали

### Архитектура сервисов

- `apiService.ts` - базовый HTTP клиент с обработкой ошибок
- `authService.ts` - аутентификация с fallback на демо режим
- `productService.ts` - управление товарами с fallback
- `userService.ts` - управление пользователями с fallback
- `demoApiService.ts` - моковые данные для демонстрации

### Обработка ошибок

- Автоматический fallback на демо данные при недоступности API
- Toast уведомления для пользователя
- Логирование ошибок в консоль для отладки

### Безопасность

- JWT токены для аутентификации
- Автоматическая очистка недействительных токенов
- Защита админ-роутов
- Валидация на стороне клиента и сервера

## Возможные проблемы и решения

1. **Backend недоступен**: Приложение автоматически переключится в демо режим
2. **CORS ошибки**: Убедитесь что backend настроен на правильный URL фронтенда
3. **MongoDB недоступен**: Проверьте подключение к базе данных
4. **Порты заняты**: Vite автоматически найдет свободный порт

## Следующие шаги

После успешного тестирования интеграции можно:

1. Настроить продакшн сборку
2. Подготовить деплой на render.com или другую платформу
3. Добавить дополнительную функциональность (корзина, заказы, платежи)
4. Настроить мониторинг и логирование

## Команды для быстрого старта

```bash
# Полный стек (требует MongoDB)
cd server && npm run dev &
cd .. && npm run dev

# Только фронтенд (демо режим)
npm run dev
```
